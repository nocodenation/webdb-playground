server {
    listen 80;

    # pgAdmin UI with webserver auto-login
    location / {
        proxy_pass http://pgadmin:80;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_set_header X-Authentication-Id "PLAYGROUND_USER";
        proxy_set_header X-Authentication-Email "user@nocodenation.org";
        proxy_set_header X-Authentication-Name "Playground User";
        proxy_set_header X-Authentication-Company-Id "NOCODENATION_ORG";
        proxy_set_header X-Authentication-Company-Name "NoCodeNation";
        proxy_set_header X-Authentication-Company-Domain "nocodenation.org";
    }
}

server {
    listen 81;

    # PostgREST API with JWT authentication
    location / {
        # Inject API key as Bearer token if not provided by client
        set $auth $http_authorization;
        if ($auth = '') {
            set $auth "Bearer API_KEY_PLACEHOLDER";
        }

        proxy_pass http://postgrest_app:3000;
        proxy_set_header Host $host;
        proxy_set_header Authorization $auth;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
